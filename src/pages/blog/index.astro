---
import HeroBanner from "../../components/HeroBanner.astro";
import {
  BlogPostFrontmatter,
  getBlogPostFullTitle,
} from "../../helpers/blogHelpers";
import AppLayout from "../../layouts/AppLayout.astro";

const allPosts = (await Astro.glob<BlogPostFrontmatter>("./*.md")).filter(
  (post) => !post.frontmatter.draft
);

const combatDesignPosts = allPosts.filter((post) =>
  post.frontmatter.tags?.includes("combat design")
);

const gameAnalysisPosts = allPosts.filter((post) =>
  post.frontmatter.tags?.includes("game analysis")
);

const gameMechanicPosts = allPosts.filter((post) =>
  post.frontmatter.tags?.includes("game mechanics")
);

const levelDesignPosts = allPosts.filter((post) =>
  post.frontmatter.tags?.includes("level design")
);

const questDesignPosts = allPosts.filter((post) =>
  post.frontmatter.tags?.includes("quest design")
);

const title = "Blog";
---

<AppLayout title={title}>
  <HeroBanner
    patternSrc="url('/images/global/hero-patterns/graph-paper.svg')"
    subtitle={title}
  />

  <div
    class="content-container flexbox-vertical with-responsive-padding-inline"
  >
    {
      combatDesignPosts.length > 0 && (
        <div class="section">
          <h1 class="heading">Combat Design</h1>

          <ul class="list-without-bullets posts-list">
            {combatDesignPosts
              .sort((a, b) => b.file.localeCompare(a.file))
              .map((post) => (
                <li>
                  <a class="text-link" href={post.url}>
                    {getBlogPostFullTitle(post.frontmatter)}
                  </a>
                </li>
              ))}
          </ul>
        </div>
      )
    }

    {
      gameAnalysisPosts.length > 0 && (
        <div class="section">
          <h1 class="heading">Game Analysis</h1>

          <ul class="list-without-bullets posts-list">
            {gameAnalysisPosts
              .sort((a, b) => b.file.localeCompare(a.file))
              .map((post) => (
                <li>
                  <a class="text-link" href={post.url}>
                    {getBlogPostFullTitle(post.frontmatter)}
                  </a>
                </li>
              ))}
          </ul>
        </div>
      )
    }

    {
      gameMechanicPosts.length > 0 && (
        <div class="section">
          <h1 class="heading">Game Mechanics</h1>

          <ul class="list-without-bullets posts-list">
            {gameMechanicPosts
              .sort((a, b) => b.file.localeCompare(a.file))
              .map((post) => (
                <li>
                  <a class="text-link" href={post.url}>
                    {getBlogPostFullTitle(post.frontmatter)}
                  </a>
                </li>
              ))}
          </ul>
        </div>
      )
    }

    {
      levelDesignPosts.length > 0 && (
        <div class="section">
          <h1 class="heading">Level Design</h1>

          <ul class="list-without-bullets posts-list">
            {levelDesignPosts
              .sort((a, b) => b.file.localeCompare(a.file))
              .map((post) => (
                <li>
                  <a class="text-link" href={post.url}>
                    {getBlogPostFullTitle(post.frontmatter)}
                  </a>
                </li>
              ))}
          </ul>
        </div>
      )
    }

    {
      questDesignPosts.length > 0 && (
        <div class="section">
          <h1 class="heading">Quest Design</h1>

          <ul class="list-without-bullets posts-list">
            {questDesignPosts
              .sort((a, b) => b.file.localeCompare(a.file))
              .map((post) => (
                <li>
                  <a class="text-link" href={post.url}>
                    {getBlogPostFullTitle(post.frontmatter)}
                  </a>
                </li>
              ))}
          </ul>
        </div>
      )
    }
  </div>
</AppLayout>

<style>
  .content-container {
    gap: var(--spacing-7);
    padding-block: var(--spacing-7);
    text-align: center;
  }

  .heading {
    font-size: var(--font-size-5);
    margin-block-end: var(--spacing-3);
  }

  .posts-list {
    gap: var(--spacing-2);
  }
</style>
